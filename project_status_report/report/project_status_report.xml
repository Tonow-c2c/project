<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="project_status_report" name="project_status_report">

        <t t-call="report.html_container">

            <t t-foreach="docs" t-as="o">
                <div class="page">

                    <table width="100%">
                        <tr>
                            <td width="50%"><b><span t-field="o.name"/></b></td>
                            <td width="50%" style="text-align: right;"><span t-field="o.state"/></td>
                        </tr>
                    </table>


                    <h2 style="border-style:solid;border-width:1px;">Project evaluation sheet</h2>

                    <br/>

                    <t t-foreach="o.get_evaluation_indicators_for_report()" t-as="evaluation_indicator">
                        <table width="100%">
                            <tr>
                                <td width="10%" style="vertical-align:middle;"><span t-esc="evaluation_indicator[0]"/></td>
                                <td width="5%" style="vertical-align:middle;">
                                    <span t-att-style="'background-color:' + evaluation_indicator[1] + ';display: block;width: 30px;height: 30px;cursor: pointer;'"/>
                                </td>
                                <td width="15%" style="text-align: center;vertical-align:middle;">Remarks</td>
                                <td width="70%" style="border-style:solid;border-width:1px;"><t t-raw="evaluation_indicator[2]"/></td>
                            </tr>
                        </table>
                        <br/>
                    </t>

                    <br/>

                    <table width="100%">
                        <tr>
                            <td width="10%">Risks</td>
                            <td width="90%" style="border-style:solid;border-width:1px;vertical-align:middle;"><t t-raw="o.risks"/></td>
                        </tr>
                    </table>

                    <br/>

                    <h3 style="border-style:solid;border-width:1px;">Project indicators</h3>

                    <br/>

                    <!--
                        Here we want to display project indicators on 2 columns.

                        By example, if project indicators are a, b, c, d, e, we will display
                        a  b
                        c  d
                        e

                        The foreach value will transform project indicators list to do that.
                        Example: [a, b, c, d, e] ==> [[a, b], [c, d], [e]]
                    -->
                    <t t-foreach="[o.indicator_ids[i:i+2] for i in xrange(0, len(o.indicator_ids), 2)]" t-as="project_indicator_lines">
                        <table width="100%">
                            <tr>
                                <!-- First project indicator in first column -->
                                <t t-call="project_status_report.project_status_report_project_indicator_line">
                                    <t t-set="project_indicator_line" t-value="project_indicator_lines[0]"/>
                                </t>
                                <!-- Space with columns -->
                                <td width="10%"/>
                                <!-- Second project indicator in second column (if we have second project indicator in line) -->
                                <t t-if="len(project_indicator_lines) == 2">
                                    <t t-call="project_status_report.project_status_report_project_indicator_line">
                                        <t t-set="project_indicator_line" t-value="project_indicator_lines[1]"/>
                                    </t>
                                </t>
                                <!-- Empty second column (if we don't have second project indicator in line) -->
                                <t t-if="len(project_indicator_lines) == 1">
                                    <td width="35%"/>
                                    <td width="10%"/>
                                </t>
                            </tr>
                        </table>
                        <br/>
                    </t>

                </div>
            </t>

        </t>
    </template>

    <template id="project_status_report_project_indicator_line" name="project_status_report_project_indicator_line">
        <td width="35%"><span t-esc="project_indicator_line.name"/></td>
        <td width="10%" t-att-style="'border-color:' + project_indicator_line.color + ';border-style:solid;border-width:2px;text-align: center;'">
            <span t-esc="project_indicator_line.display_value"/>
        </td>
    </template>

    <report
            id="report_project_status_report"
            model="project.status.report"
            string="Project status report"
            report_type="qweb-pdf"
            name="project_status_report.project_status_report"
            file="project_status_report.project_status_report"
            paperformat="report.paperformat_euro"/>

</odoo>
